<!DOCTYPE html>
<html>
<head>
    <title>Xenosis JS Miner</title>
</head>
<body>
<h2>Xenosis Proof-of-Bits Test</h2>

<label>Masukkan text:</label><br>
<input type="text" id="text" value="Hello XENO"><br><br>

<button onclick="startMining()">Start Mining Proof</button>
<pre id="log"></pre>

<script>
async function sha256(msg) {
    const buffer = new TextEncoder().encode(msg);
    const digest = await crypto.subtle.digest("SHA-256", buffer);
    return Array.from(new Uint8Array(digest))
        .map(b => b.toString(16).padStart(2, '0'))
        .join('');
}

async function startMining() {
    const log = msg => document.getElementById("log").textContent += msg + "\n";
    document.getElementById("log").textContent = "";

    const text = document.getElementById("text").value;

    // ====== 1. Request challenge from backend ======
    const res = await fetch("https://xeno-backend.cloudflareaccess.com/backend.php?action=challenge");
    const { salt, target } = await res.json();
    log("Salt: " + salt);
    log("Target: " + target);

    // ====== 2. Mining nonce ======
    let nonce = 0;
    while (true) {
        const hash = await sha256(text + salt + nonce);
        if (hash.startsWith(target)) {
            log("Hash found: " + hash);
            log("Nonce: " + nonce);

            // ====== 3. Submit proof to backend ======
            const verify = await fetch(
                "https://xeno-backend.cloudflareaccess.com/backend.php?action=verify",
                {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `text=${text}&salt=${salt}&nonce=${nonce}&target=${target}`
                }
            );
            const result = await verify.json();
            log("Server verify: " + JSON.stringify(result));
            return;
        }
        nonce++;
    }
}
</script>
</body>
</html>
